<div class="grid p-fluid">
    <div class="col-12">
        <div class="card">
            <h5>Announcement List</h5>
            <p-table #dt3 [value]="announcements" dataKey="id" [rows]="10" [rowHover]="true"
                styleClass="p-datatable-gridlines" [paginator]="true"
                [globalFilterFields]="['title', 'createdBy', 'categoryName', 'role']" responsiveLayout="scroll">


                <ng-template pTemplate="header">
                    <tr>
                        <th style="min-width: 4rem">No</th>
                        <th style="min-width: 12rem">Title
                            <p-columnFilter type="text" field="title" display="menu"
                                placeholder="Search by title"></p-columnFilter>
                        </th>
                        <th style="min-width: 8rem">Created By<p-columnFilter type="text" field="creater" display="menu"
                                placeholder="Search by name"></p-columnFilter>
                        </th>
                        <th style="min-width: 12rem">Created At</th>
                        <th style="min-width: 8rem">Status</th>
                        <th style="min-width: 8rem">Category</th>
                        <th style="min-width: 8rem">Role<p-columnFilter type="text" field="role" display="menu"
                                placeholder="Search by name"></p-columnFilter></th>
                        <th style="min-width: 10rem">Actions</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-announcement let-i="rowIndex">
                    <tr>
                        <td>{{i + 1}}</td>
                        <td>{{announcement.title}}</td>
                        <td>{{announcement.createdBy}}</td>
                        <td>{{announcement.createdAt | date:'MMM d,y'}}</td>
                        <td>{{announcement.status}}</td>
                        <td>{{announcement.categoryName}}</td>
                        <td>{{announcement.role}}</td>
                        <td>
                            <button pButton icon="pi pi-eye" label="Show" style="width: 100px;"
                                (click)="showDetails(announcement)"></button>

                            <!-- <a [href]="announcement.fileUrl" target="_blank" rel="noopener noreferrer">
                                <button pButton icon="pi pi-external-link" label="Show" style="width: 100px;"></button>
                            </a> -->
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="8">No announcements found.</td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="8">Loading announcement data. Please wait.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
<p-dialog header="Announcement Details" [(visible)]="displayDialog" [modal]="true" [closable]="true"
    (onHide)="onDialogHide()" [style]="{width: '50vw'}">
    <div *ngIf="selectedAnnouncement">
        <h3>{{ selectedAnnouncement.title }}</h3>
        <p><strong>Created By:</strong> {{ selectedAnnouncement.createdBy }}</p>
        <p><strong>Created At:</strong> {{ selectedAnnouncement.createdAt | date: 'MMM d, yyyy' }}</p>
        <p><strong>Content Type:</strong> {{ selectedAnnouncement.contentType  }}</p>


        <!-- Content Viewer -->
        <div *ngIf="selectedAnnouncement.contentType === 'PDF'">
            <pdf-viewer [src]="selectedAnnouncement.fileUrl" [render-text]="true"
                style="display: block; width: 100%; height: 500px;">
            </pdf-viewer>
        </div>
        <div *ngIf="selectedAnnouncement.contentType === 'IMAGE'">
            <img [src]="selectedAnnouncement.fileUrl" alt="Image Content"
                style="display: block; width: 100%; height:auto;" />
        </div>
        <div *ngIf="selectedAnnouncement.contentType === 'VIDEO'">
            <video [src]="selectedAnnouncement.fileUrl" controls style="display: block; width: 100%; height: 500px;">
                Your browser does not support the video tag.
            </video>
        </div>
        <div *ngIf="selectedAnnouncement.contentType === 'AUDIO'">
            <audio [src]="selectedAnnouncement.fileUrl" controls style="display: block; width: 100%;">
                Your browser does not support the audio element.
            </audio>
        </div>
        <div *ngIf="selectedAnnouncement.contentType === 'EXCEL'">
            <iframe [src]="selectedAnnouncement.fileUrl " style="display: block; width: 100%; height: 500px;">
            </iframe>
        </div>

        <!-- Container for heading and add comment button -->
        <div class="comment-header">
            <h4>Comments:</h4>
            <button pButton type="button" label="Add Comment" icon="pi pi-comment" (click)="openModal()"></button>
        </div>

        <!-- Display list of comments -->
        <div *ngIf="comments.length > 0">
            <ul>
                <li *ngFor="let comment of comments; let i = index">
                    <strong>{{ comment.author }}:</strong> {{ comment.text }}

                    <!-- Add Reply Button (icon only) -->
                    <button pButton type="button" icon="pi pi-reply"
                        class="p-button-rounded p-button-icon-only reply-icon" (click)="toggleReply(i)"></button>

                    <!-- Reply Input Box (conditionally visible) -->
                    <div *ngIf="comment.showReplyBox">
                        <textarea [(ngModel)]="comment.replyText" placeholder="Enter your reply" rows="3"
                            cols="30"></textarea>
                        <div>
                            <button pButton type="button" label="Reply" icon="pi pi-check"
                                (click)="addReply(i)"></button>
                            <button pButton type="button" label="Cancel" icon="pi pi-times"
                                (click)="cancelReply(i)"></button>
                        </div>
                    </div>

                    <!-- Display replies (if any) -->
                    <ul *ngIf="comment.replies.length > 0">
                        <li *ngFor="let reply of comment.replies">
                            <strong>{{ reply.author }}:</strong> {{ reply.text }}
                        </li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- Modal for adding comment -->
        <p-dialog header="Add Comment" [(visible)]="showModal" [modal]="true" [closable]="true"
            [style]="{width: '30vw'}">
            <div>
                <textarea [(ngModel)]="newComment" placeholder="Enter your comment here" rows="5" cols="30"></textarea>
            </div>
            <p-footer>
                <button pButton type="button" label="Submit" icon="pi pi-check" (click)="addComment()"></button>
                <button pButton type="button" label="Cancel" icon="pi pi-times" (click)="clearComment()"></button>
            </p-footer>
        </p-dialog>

        <style>
            .comment-header {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .comment-header button {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }

            li {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
            }

            .reply-icon {
                font-size: 0.7rem;
                padding: 0.3rem;
                margin-left: 10px;
            }

           
            .reply-box {
                display: flex;
                flex-direction: column;
                gap: 10px;
               
                margin-top: 10px;
                
            }

           
            textarea {
                width: 100%;
                resize: vertical;
              
            }

            
            .reply-box-buttons button {
                margin-right: 5px;
               
            }
        </style>