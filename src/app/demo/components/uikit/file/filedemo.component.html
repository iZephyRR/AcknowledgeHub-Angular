<div class="col-12">
    <div class="card">
        <h5>User List with Expandable Rows</h5>
        <p-toast></p-toast>
        <p-table [value]="users" dataKey="name" [expandedRowKeys]="expandedRows" responsiveLayout="scroll">
            <ng-template pTemplate="caption">
                <button pButton icon="pi pi-fw {{isExpanded ? 'pi-minus' : 'pi-plus'}}" 
                        label="{{isExpanded ? 'Collapse All' : 'Expand All'}}" 
                        (click)="expandAll()"></button>
                <div class="flex table-header">
                    <input #filter type="text" pInputText placeholder="Global Search" 
                           (input)="onGlobalFilter($event.target.table, $event)" />
                    <button pButton icon="pi pi-refresh" (click)="clear($event.target.table)"></button>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 3rem"></th>
                    <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
                    <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
                    <th pSortableColumn="role">Role <p-sortIcon field="role"></p-sortIcon></th>
                    <th pSortableColumn="workEntryDate">Work Entry Date <p-sortIcon field="workEntryDate"></p-sortIcon></th>
                    <th pSortableColumn="company">Company <p-sortIcon field="company"></p-sortIcon></th>
                    <th pSortableColumn="department">Department <p-sortIcon field="department"></p-sortIcon></th>
                    <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-user let-expanded="expanded">
                <tr>
                    <td>
                        <button type="button" pButton pRipple [pRowToggler]="user"
                                class="p-button-text p-button-rounded p-button-plain"
                                [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                    </td>
                    <td>{{user.name}}</td>
                    <td>{{user.email}}</td>
                    <td>{{user.role}}</td>
                    <td>{{user.workEntryDate | date: 'MM/dd/yyyy'}}</td>
                    <td>{{user.company.name}}</td>
                    <td>{{user.department.name}}</td>
                    <td><span [class]="'user-badge status-' + user.status.toLowerCase()">{{user.status}}</span></td>
                </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-user>
                <tr>
                    <td colspan="8">
                        <div class="p-3">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td><strong>Address:</strong> {{user.address}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Gender:</strong> {{user.gender}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Date of Birth:</strong> {{user.dob | date: 'MM/dd/yyyy'}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>NRC:</strong> {{user.nrc}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Staff ID:</strong> {{user.staffId}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Telegram Username:</strong> {{user.telegramUsername}}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Photo Link:</strong> <img [src]="user.photolink" alt="User Photo" style="max-width: 100%; height: auto;" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
