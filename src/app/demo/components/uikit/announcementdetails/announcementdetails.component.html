<ng-container *ngIf="announcementService.showNotedReport; else announcementView">
  <app-each-anno-noted-list [announcementId]="announcement.id"></app-each-anno-noted-list>
</ng-container>
<ng-template #announcementView>
  <div *ngIf="announcement" class="card-container">
    <div class="card">
      <div class="card-header" style="display: flex;justify-content: space-between;">
        <h3 class="card-title">{{ announcement.title }}</h3>
        <button *ngIf="announcement.announcementResponseCondition!='RECEIVER'" pButton pRipple label="Report"
          (click)="showReport()"></button>
      </div>
      <div class="card-body">
        <p>Created at: {{ announcement.createdAt | date: 'MMM d, y' }}</p>
        <h5 class="card-title">Content Type: {{ announcement.contentType }}</h5>

        <!-- PDF Viewer -->
        <pdf-viewer *ngIf="announcement.contentType === 'PDF'" [src]="announcement.pdfLink" [render-text]="true"
          style="display: block; width: 80%; height: 400px;">
        </pdf-viewer>

        <!-- Image Viewer -->
        <img *ngIf="announcement.contentType === 'IMAGE'" [src]="safePdfLink" alt="Image Content"
          style="display: block; width: 80%; height: auto;" />

        <!-- Video Player -->
        <video *ngIf="announcement.contentType === 'VIDEO'" [src]="safePdfLink" controls
          style="display: block; width: 80%; height: 400px;">
        </video>

        <!-- Audio Player -->
        <audio *ngIf="announcement.contentType === 'AUDIO'" [src]="safePdfLink" controls
          style="display: block; width: 80%;">
        </audio>
        <!-- Excel Viewer -->
        <iframe *ngIf="announcement.contentType === 'EXCEL'" [src]="safePdfLink"
          style="display: block; width: 80%; height: 400px;">
        </iframe>
        <br>
        <!-- Button to open the modal -->
        <button type="button" pButton label="Add Comment" (click)="openModal()"></button>

        <!-- p-dialog Modal -->
        <p-dialog header="Add a Comment" [(visible)]="showModal" [modal]="true" [closable]="true"
          [style]="{'width': '40vw'}" (onHide)="clearComment()">

          <!-- Add Comment Box -->
          <div class="comment-box" *ngIf="condition === 'RECEIVER'">
            <!-- <div class="comment-avatar">
            <img [src]="'assets/default-profile.png'" alt="Your Profile" class="avatar" />
          </div> -->
            <div class="comment-input-container">
              <textarea [(ngModel)]="newComment" placeholder="Write your comment..."
                class="comment-textarea"></textarea>
              <div class="comment-actions">
                <button pButton label="Comment" icon="pi pi-check" class="comment-button"
                  (click)="addComment(announcement.id)" [disabled]="!newComment.trim()"></button>
                <button pButton label="Cancel" icon="pi pi-times" class="cancel-button"
                  (click)="clearComment()"></button>
              </div>
            </div>
          </div>

          <!-- Display comments -->
          <div *ngIf="comments().length > 0; else noComments">
            <div *ngFor="let comment of comments()" class="comment-container">
              <div class="comment-avatar">
                <img *ngIf="comment.safePhotoLink; else defaultImage" [src]="comment.safePhotoLink" alt="Profile"
                  class="avatar" />
                <ng-template #defaultImage>
                  <img [src]="'assets/default-profile.png'" alt="Default Profile Image" class="avatar" />
                </ng-template>
              </div>
              <div class="comment-body">
                <div class="comment-header">
                  <span class="author">{{ comment.author }}</span>
                  <span class="comment-time">{{ comment.createdAt | timeAgo }}</span>
                </div>
                <p class="comment-content">{{ comment.content }}</p>

                <!-- Reply Section -->
                <div class="comment-actions" *ngIf="condition === 'CREATOR'">
                  <button class="reply-btn" (click)="toggleReplyBox(comment.id)">Reply</button>
                </div>

                <div class="comment-actions" *ngIf="condition != 'CREATOR'">
                  <button class="reply-btn" (click)="toggleReplyBox(comment.id)">Replies</button>
                </div>

                <div *ngIf="activeReplyBoxId === comment.id && condition === 'CREATOR' " class="reply-input-container">
                  <!-- <div class="reply-avatar">
                  <img [src]="'assets/default-profile.png'" alt="Profile" class="avatar" />
                </div> -->
                  <div class="reply-input-wrapper">
                    <textarea [(ngModel)]="replyText" placeholder="Add a public reply..."
                      class="reply-textarea"></textarea>
                    <div class="reply-actions">
                      <button pButton label="Cancel" icon="pi pi-times" class="cancel-reply-btn"
                        (click)="toggleReplyBox(null)"></button>
                      <button pButton label="Reply" icon="pi pi-check" class="submit-reply-btn"
                        (click)="submitReply(comment.id)" [disabled]="!replyText.trim()"></button>
                    </div>
                  </div>
                </div>
                <div class="replies-container" *ngIf="activeReplyBoxId === comment.id && replies().length > 0">
                  <div *ngFor="let reply of replies()" class="reply-container">
                    <div class="reply-avatar">
                      <img *ngIf="reply.safePhotoLink; else defaultImage" [src]="reply.safePhotoLink" alt="Profile"
                        class="avatar" />
                      <ng-template #defaultImage>
                        <img [src]="'assets/default-profile.png'" alt="Default Profile Image" class="avatar" />
                      </ng-template>
                    </div>
                    <div class="comment-body">
                      <div class="reply-header">
                        <span class="reply-author">{{ reply.replierName }}</span>
                        <span class="reply-time">{{ reply.replyCreatedAt | timeAgo }}</span>
                      </div>
                      <p class="reply-content">{{ reply.replyContent }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- No Comments Template -->
          <ng-template #noComments>
            <p class="no-comments-text">There has no comments.</p>
          </ng-template>
        </p-dialog>
      </div>
    </div>
  </div>
</ng-template>

